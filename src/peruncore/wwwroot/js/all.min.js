function dataURLtoMimeType(n){var e=";base64,",r,i,h,u,f,t;if(n.indexOf(e)==-1)i=n.split(","),h=i[0].split(":")[1],r=decodeURIComponent(i[1]);else{var i=n.split(e),h=i[0].split(":")[1],o=window.atob(i[1]),s=o.length;for(r=new Uint8Array(s),t=0;t<s;++t)r[t]=o.charCodeAt(t)}for(u=r.subarray(0,4),f="",t=0;t<u.length;t++)f+=u[t].toString(16);switch(f){case"89504e47":mimeType="image/png";break;case"47494638":mimeType="image/gif";break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":mimeType="image/jpeg";break;default:mimeType=""}return mimeType}jQuery.validator.addMethod("nospaces",function(n){return n.indexOf(" ")<0&&n!=""},"Username has invalid characters. Spaces are not allowed.");jQuery.validator.unobtrusive.adapters.add("nospaces",function(n){n.rules.nospaces=!0;n.message&&(n.messages.nospaces=n.message)});jQuery.validator.addMethod("noweirdstuff",function(n){return!/\W/.test(n)},"Username has invalid characters. Only letters, numbres & underscores allowed.");jQuery.validator.unobtrusive.adapters.add("noweirdstuff",function(n){n.rules.noweirdstuff=!0;n.message&&(n.messages.noweirdstuff=n.message)});jQuery.validator.unobtrusive.adapters.add("passwordmeter",function(n){n.rules.passwordmeter=!0;n.message&&(n.messages.passwordmeter=n.message)}),function(){function t(){$preloader.show();$btnAvatarUpload.prop("disabled",!0);$btnAvatarCancel.prop("disabled",!0)}function n(){$avatarCropModal.hide();$image.attr("src","");$input.val("");cropper.destroy();cropper=undefined;$preloader.hide();$btnAvatarUpload.prop("disabled",!1);$btnAvatarCancel.prop("disabled",!1)}mimeType=undefined;$fileChangeAvatar=$("#file-change-avatar");$avatarCropModal=$("#crop-avatar-modal");$btnAvatarUpload=$("#btn-avatar-upload");$btnAvatarCancel=$("#btn-avatar-cancel");$imageAvatar=$(".img-avatar");$preloader=$(".preloader");$image=$("#preview-image");$input=$("#file-change-avatar");$fileChangeAvatar.change(function(){var n=new FileReader;n.onload=function(){mimeType=dataURLtoMimeType(this.result);$image.attr("src",this.result);cropper=new Cropper($avatarCropModal.find("img")[0],{viewMode:1,aspectRatio:1,responsive:!0,zoomable:!1,rotable:!1,scalable:!1,minCropBoxWidth:300,minCropBoxHeight:300})};n.onloadend=function(){$avatarCropModal.show()};n.readAsDataURL(this.files[0])});$btnAvatarUpload.click(function(){cropper.getCroppedCanvas().toBlob(function(i){var r=new FormData;r.append("avatar_image",i);$.ajax("/avatar/upload",{method:"POST",data:r,contentType:!1,processData:!1,beforeSend:function(){t()},success:function(t){$imageAvatar.attr("src",t.imageUrl);n()},error:function(){n()}})},mimeType,.9)});$btnAvatarCancel.click(function(){n()})}();