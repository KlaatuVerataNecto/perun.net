jQuery.validator.addMethod("nospaces",function(n){return n.indexOf(" ")<0&&n!=""},"Username has invalid characters. Spaces are not allowed.");jQuery.validator.unobtrusive.adapters.add("nospaces",function(n){n.rules.nospaces=!0;n.message&&(n.messages.nospaces=n.message)});jQuery.validator.addMethod("noweirdstuff",function(n){return!/\W/.test(n)},"Username has invalid characters. Only letters, numbres & underscores allowed.");jQuery.validator.unobtrusive.adapters.add("noweirdstuff",function(n){n.rules.noweirdstuff=!0;n.message&&(n.messages.noweirdstuff=n.message)});jQuery.validator.unobtrusive.adapters.add("passwordmeter",function(n){n.rules.passwordmeter=!0;n.message&&(n.messages.passwordmeter=n.message)});Dropzone.autoDiscover=!1,function(){function h(){var t=n.getAcceptedFiles(),u,r,f;t.length!==0&&(u=document.createElement("canvas"),u.width=t[0].width,u.height=t[0].height,r=u.getContext("2d"),r.beginPath(),r.rect(0,0,t[0].width,t[0].height),r.fillStyle="white",r.fill(),f=new Image,f.onload=function(){r.drawImage(f,0,0);var n=i.find("img")[0];n.onload=function(){i.modal("show")};n.src=u.toDataURL("image/jpeg")},f.src=t[0].dataURL)}var r=!1,u=undefined,t=$("#avatar-modal"),i=$("#crop-avatar-modal"),o=$("#avatar-dropzone"),f=$("#avatar-error"),e=o.find(".dz-message"),s=$("#start-avatar-upload"),n=new Dropzone("#avatar-dropzone",{url:"/avatar/upload",params:{avatar_x:0,avatar_y:0,avatar_width:0,avatar_height:0},paramName:"avatar_image",thumbnailWidth:300,thumbnailHeight:300,clickable:["#avatar-select-button"],autoQueue:!1,maxFiles:2,maxFilesize:2,acceptedFiles:"image/*",accept:function(t,i){$(".dz-progress").remove();$(".dz-size").remove();$(".dz-filename").remove();f.text("").hide();e.hide();this.files.length>1&&n.removeFile(n.files[0]);i()},error:function(n,i){f.text(i).show();r?(t.find("button:not(#start-avatar-crop)").removeAttr("disabled"),this.files.length===0&&$startAvatarCrop.attr("disabled","")):this.removeFile(n);r=!1},success:function(n,t){t&&t.imageUrl&&$("img[data-user-avatar]").attr("src",t.imageUrl)},previewsContainer:"#avatar-preview",previewTemplate:'<div class="dz-preview dz-image-preview"><div class="dz-image"><img data-dz-thumbnail /><\/div><div class="dz-details"><div class="dz-size"><span data-dz-size><\/span><\/div><div class="dz-filename"><span data-dz-name><\/span><\/div><\/div><div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress><\/span><\/div><\/div>'});n.on("removedfile",function(){this.files.length===0&&e.show()}).on("thumbnail",function(i){n.options.params.avatar_x=0;n.options.params.avatar_y=0;n.options.params.avatar_width=Math.round(i.width);n.options.params.avatar_height=Math.round(i.height);t.modal("hide");h()}).on("sending",function(){r=!0;t.find("button").attr("disabled","")}).on("success",function(){r=!1;t.modal("hide")});s.on("click",function(){i.modal("hide");n.enqueueFiles(n.getAcceptedFiles())});t.on("show.bs.modal",function(){n.removeAllFiles();t.find("button:not(#start-avatar-crop)").removeAttr("disabled")}).on("hide.bs.modal",function(n){return r?(n.preventDefault(),n.stopImmediatePropagation(),!1):!0}).on("hidden.bs.modal",function(){f.text("").hide()});i.on("shown.bs.modal",function(){u=new Cropper(i.find("img")[0],{viewMode:1,aspectRatio:1,zoomable:!1,rotable:!1,scalable:!1,minCropBoxWidth:300,minCropBoxHeight:300,crop:function(t){n.options.params.avatar_x=Math.round(t.detail.x);n.options.params.avatar_y=Math.round(t.detail.y);n.options.params.avatar_width=Math.round(t.detail.width);n.options.params.avatar_height=Math.round(t.detail.height)}})}).on("hidden.bs.modal",function(){u.destroy();u=undefined;i.find("img")[0].src=""})}();