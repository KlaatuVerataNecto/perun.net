function validFileImageSize(n,t,i,r){getFileImageSize(n,function(n){var u=!0;(n.width<t||n.height<i)&&(u=!1);r(u)})}function getFileImageSize(n,t){var i=new Image;i.onload=function(){var n={width:i.width,height:i.height};t(n)};i.src=n}function dataURItoBlob(n){for(var i=atob(n.split(",")[1]),u=n.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(i.length),f=new Uint8Array(r),t=0;t<i.length;t++)f[t]=i.charCodeAt(t);return new Blob([r],{type:u})}function dataURLtoMimeType(n){var e=";base64,",r,i,h,u,f,t;if(n.indexOf(e)==-1)i=n.split(","),h=i[0].split(":")[1],r=decodeURIComponent(i[1]);else{var i=n.split(e),h=i[0].split(":")[1],o=window.atob(i[1]),s=o.length;for(r=new Uint8Array(s),t=0;t<s;++t)r[t]=o.charCodeAt(t)}for(u=r.subarray(0,4),f="",t=0;t<u.length;t++)f+=u[t].toString(16);switch(f){case"89504e47":mimeType="image/png";break;case"47494638":mimeType="image/gif";break;case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":mimeType="image/jpeg";break;default:mimeType=""}return mimeType}(function(){function r(){$(".overlay-cover").show()}function i(){$(".overlay-cover").hide();n()}function u(){$(".change-cover").hide();$(".profile-cover .media").hide();$("#change-cover-buttons").show()}function n(){$fileChangeCover.val("");$(".cropit-preview").removeClass("cropit-image-loaded");$(".cropit-preview-image").removeAttr("style");$(".cropit-preview-image").attr("src","");$coverCropper.cropit("destroy");$(".change-cover").show();$(".profile-cover .media").show();$("#change-cover-buttons").hide()}function f(){$(".overlay-avatar").show();$btnAvatarUpload.prop("disabled",!0);$btnAvatarCancel.prop("disabled",!0)}function t(){$(".overlay-avatar").hide();$avatarCropModal.hide();$avatarImagePreview.attr("src","");$fileChangeAvatar.val("");cropper.destroy();cropper=undefined;$btnAvatarUpload.prop("disabled",!1);$btnAvatarCancel.prop("disabled",!1)}MIN_COVER_WIDTH=1140;MIN_COVER_HEIGHT=350;mimeType=undefined;$fileChangeAvatar=$("#file-avatar-change");$avatarCropModal=$("#crop-avatar-modal");$btnAvatarUpload=$("#btn-avatar-save");$btnAvatarCancel=$("#btn-avatar-cancel");$avatarImage=$(".img-avatar");$avatarImagePreview=$("#preview-image");$coverImage=$(".profile-cover-img");$coverCropper=$("#image-cropper");$fileChangeCover=$("#file-cover-change");$btnCoverSave=$("#btn-cover-save");$btnCoverCancel=$("#btn-cover-cancel");$coverMessageModal=$("#cover-message-modal");$btnCoverMessageCancel=$("#btn-cover-message-cancel");$fileChangeCover.change(function(){$coverCropper.cropit({onImageError:function(){$coverMessageModal.show();n()}});var t=new FileReader;t.onload=function(){var t=this.result;validFileImageSize(t,MIN_COVER_WIDTH,MIN_COVER_HEIGHT,function(i){i?(u(),$coverCropper.cropit("imageSrc",t)):($coverMessageModal.show(),n())})};t.readAsDataURL(this.files[0])});$btnCoverSave.click(function(){var t=$coverCropper.cropit("export",{type:"image/jpeg",quality:1}),u=dataURItoBlob(t),n=new FormData;n.append("cover_image",u);$.ajax("/image/cover",{method:"POST",data:n,contentType:!1,processData:!1,beforeSend:function(){r()},success:function(n){i();$coverImage.css("background-image","url("+n.imageUrl+")")},error:function(){i();$coverMessageModal.show()}})});$btnCoverCancel.click(function(){n()});$btnCoverMessageCancel.click(function(){$coverMessageModal.hide()});$fileChangeAvatar.change(function(){var n=new FileReader;n.onload=function(){mimeType=dataURLtoMimeType(this.result);$avatarImagePreview.attr("src",this.result);cropper=new Cropper($avatarCropModal.find("img")[0],{viewMode:1,aspectRatio:1,responsive:!0,zoomable:!1,rotable:!1,scalable:!1,minCropBoxWidth:300,minCropBoxHeight:300})};n.onloadend=function(){$avatarCropModal.show()};n.readAsDataURL(this.files[0])});$btnAvatarUpload.click(function(){cropper.getCroppedCanvas().toBlob(function(n){var i=new FormData;i.append("avatar_image",n);$.ajax("/image/avatar",{method:"POST",data:i,contentType:!1,processData:!1,beforeSend:function(){f()},success:function(n){$avatarImage.attr("src",n.imageUrl);t()},error:function(){t()}})},mimeType,.9)});$btnAvatarCancel.click(function(){t()})})();