jQuery.validator.addMethod("nospaces",function(n){return n.indexOf(" ")<0&&n!=""},"Username has invalid characters. Spaces are not allowed.");jQuery.validator.unobtrusive.adapters.add("nospaces",function(n){n.rules.nospaces=!0;n.message&&(n.messages.nospaces=n.message)});jQuery.validator.addMethod("noweirdstuff",function(n){return!/\W/.test(n)},"Username has invalid characters. Only letters, numbres & underscores allowed.");jQuery.validator.unobtrusive.adapters.add("noweirdstuff",function(n){n.rules.noweirdstuff=!0;n.message&&(n.messages.noweirdstuff=n.message)});jQuery.validator.unobtrusive.adapters.add("passwordmeter",function(n){n.rules.passwordmeter=!0;n.message&&(n.messages.passwordmeter=n.message)});Dropzone.autoDiscover=!1,function(){var i=!1,u=undefined,r=$("#avatar-modal"),t=$("#crop-avatar-modal"),s=$("#avatar-dropzone"),f=$("#avatar-error"),o=s.find(".dz-message"),e=$("#start-avatar-crop"),h=$("#start-avatar-upload"),n=new Dropzone("#avatar-dropzone",{url:"/avatar/upload",params:{avatar_x:0,avatar_y:0,avatar_width:0,avatar_height:0},paramName:"avatar_image",thumbnailWidth:300,thumbnailHeight:300,clickable:["#avatar-select-button"],autoQueue:!1,maxFiles:2,maxFilesize:2,acceptedFiles:"image/*",accept:function(t,i){f.text("").hide();e.removeAttr("disabled");o.hide();this.files.length>1&&n.removeFile(n.files[0]);i()},error:function(n,t){f.text(t).show();i?(r.find("button:not(#start-avatar-crop)").removeAttr("disabled"),this.files.length===0&&e.attr("disabled","")):this.removeFile(n);i=!1},success:function(n,t){t&&t.imageUrl&&$("img[data-user-avatar]").attr("src",t.imageUrl)},previewsContainer:"#avatar-preview",previewTemplate:'<div class="dz-preview dz-image-preview"><div class="dz-image"><img data-dz-thumbnail /><\/div><div class="dz-details"><div class="dz-size"><span data-dz-size><\/span><\/div><div class="dz-filename"><span data-dz-name><\/span><\/div><\/div><div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress><\/span><\/div><\/div>'});n.on("removedfile",function(){this.files.length===0&&o.show()}).on("thumbnail",function(t){n.options.params.avatar_x=0;n.options.params.avatar_y=0;n.options.params.avatar_width=Math.round(t.width);n.options.params.avatar_height=Math.round(t.height)}).on("sending",function(){i=!0;r.find("button").attr("disabled","")}).on("success",function(){i=!1;r.modal("hide")});e.on("click",function(){var i=n.getAcceptedFiles(),u,r,f;i.length!==0&&(u=document.createElement("canvas"),u.width=i[0].width,u.height=i[0].height,r=u.getContext("2d"),r.beginPath(),r.rect(0,0,i[0].width,i[0].height),r.fillStyle="white",r.fill(),f=new Image,f.onload=function(){r.drawImage(f,0,0);var n=t.find("img")[0];n.onload=function(){t.modal("show")};n.src=u.toDataURL("image/jpeg")},f.src=i[0].dataURL)});h.on("click",function(){t.modal("hide");n.enqueueFiles(n.getAcceptedFiles())});r.on("show.bs.modal",function(){n.removeAllFiles();r.find("button:not(#start-avatar-crop)").removeAttr("disabled")}).on("hide.bs.modal",function(n){return i?(n.preventDefault(),n.stopImmediatePropagation(),!1):!0}).on("hidden.bs.modal",function(){f.text("").hide()});t.on("shown.bs.modal",function(){u=new Cropper(t.find("img")[0],{viewMode:1,aspectRatio:1,zoomable:!1,rotable:!1,scalable:!1,minCropBoxWidth:300,minCropBoxHeight:300,crop:function(t){n.options.params.avatar_x=Math.round(t.detail.x);n.options.params.avatar_y=Math.round(t.detail.y);n.options.params.avatar_width=Math.round(t.detail.width);n.options.params.avatar_height=Math.round(t.detail.height)}})}).on("hidden.bs.modal",function(){u.destroy();u=undefined;t.find("img")[0].src=""})}();